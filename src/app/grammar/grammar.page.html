<ion-header>
  <ion-toolbar class="cosmic-toolbar">
    <ion-buttons slot="start">
      <ion-button (click)="handleBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    
    <div class="header-brand">
      <span class="brand-text">
        GRAMMAR CORE <span *ngIf="selectedLevel" class="level-tag">// {{ selectedLevel }}</span>
      </span>
    </div>
    
    <ion-buttons slot="end" style="width: 48px;"></ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  <div class="deep-space-bg">
    <div class="bg-nebula"></div>
    <div class="stars-static"></div>
    <div class="stars-twinkle"></div>
  </div>
  
  <div class="container">

    <div *ngIf="currentView === 'levels'" class="view-levels fade-in">
      <div class="view-header">
        <h1>SECURITY CLEARANCE</h1>
        <p>Select access protocol level.</p>
      </div>
      <div class="levels-grid">
        <div class="level-card" *ngFor="let lvl of levels" 
             [class.locked]="lvl.status === 'LOCKED'"
             (click)="lvl.status === 'UNLOCKED' && selectLevel(lvl.code)">
          <div class="card-content">
            <span class="code">{{ lvl.code }}</span>
            <span class="rank">{{ lvl.rank }}</span>
            <div class="status-badge" [class.active]="lvl.status === 'UNLOCKED'">
              {{ lvl.status }}
            </div>
          </div>
          <div class="progress-indicator" *ngIf="lvl.status === 'UNLOCKED'">
            <div class="fill" [style.width]="lvl.progress"></div>
          </div>
          <ion-icon *ngIf="lvl.status === 'LOCKED'" name="lock-closed-outline" class="lock-icon"></ion-icon>
        </div>
      </div>
    </div>

    <div *ngIf="currentView === 'modules'" class="view-modules fade-in">
      <div class="view-header">
        <h1>A1 MODULES</h1>
        <p>Core grammar competencies.</p>
      </div>
      <div class="modules-grid">
        <div class="module-card" *ngFor="let topic of topicsA1" (click)="openTopic(topic)">
          <div class="icon-wrapper"><ion-icon [name]="topic.icon"></ion-icon></div>
          <div class="info">
            <h3>{{ topic.title }}</h3>
            <span class="desc">{{ topic.desc }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
        </div>
      </div>
    </div>

    <div *ngIf="currentView === 'topic' && activeTopic" class="view-topic fade-in">
      <div class="topic-header-bar">
        <h2>{{ activeTopic.title }}</h2>
        <div class="mode-switcher">
          <button class="mode-btn" [class.active]="activeTab === 'intel'" (click)="activeTab = 'intel'">
            <ion-icon name="terminal-outline"></ion-icon> INTEL
          </button>
          <button class="mode-btn" [class.active]="activeTab === 'training'" (click)="activeTab = 'training'">
            <ion-icon name="flash-outline"></ion-icon> TRAINING
          </button>
        </div>
      </div>

      <div class="topic-content-wrapper">
        <div *ngIf="activeTab === 'intel'" class="tab-pane intel-pane fade-in">
          <div class="content-box" [innerHTML]="activeTopic.intelHTML"></div>
        </div>
        <div *ngIf="activeTab === 'training'" class="tab-pane training-pane fade-in">
          <div class="exercise-card" *ngFor="let ex of activeTopic.exercises; let i = index" #cardRef>
            <div class="q-header">
              <span class="num">{{ i + 1 < 10 ? '0' + (i + 1) : (i + 1) }}</span>
              <p>{{ ex.q }}</p>
            </div>
            <div class="options-grid">
              <button *ngFor="let opt of ex.opts" class="opt-btn" (click)="checkAnswer(ex, opt, cardRef)">
                {{ opt }}
              </button>
            </div>
            <div class="status-line"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</ion-content>